{% extends 'core/base.html' %}

{% block content %}
<div class="header-actions">
    <div class="breadcrumb">
        <a href="{% url 'home' %}">Home</a> / Edições
    </div>
    <a href="{% url 'issue_create' %}" class="btn-circle-add open-modal" title="Nova Edição">+</a>
</div>

<h1>Edições</h1>

<div class="grid-cards">
    {% for issue in issues %}
    <a href="{% url 'issue_detail' issue.pk %}" class="card">
        <div class="card-cover">
            {% with covers=issue.covers.all %}
            {% if covers %}
            {% for cover in covers %}
            <img src="{{ cover.image.url }}" id="cover-{{ issue.pk }}-{{ forloop.counter0 }}"
                class="cover-image {% if forloop.first %}active{% endif %}" alt="Cover {{ forloop.counter }}">
            {% endfor %}

            {% if covers|length > 1 %}
            <div class="cover-nav">
                {% for cover in covers %}
                <button type="button" class="nav-dot {% if forloop.first %}active{% endif %}"
                    data-index="{{ forloop.counter0 }}"
                    onclick="switchCover(event, {{ issue.pk }}, {{ forloop.counter0 }})"></button>
                {% endfor %}
            </div>
            {% endif %}
            {% else %}
            <div
                style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; color: #9ca3af;">
                No Cover
            </div>
            {% endif %}
            {% endwith %}
        </div>
        <div class="card-content">
            <h3>{{ issue }}</h3>
            <p class="cta-text">
                Ver detalhes &rarr;
            </p>
        </div>
    </a>
    {% empty %}
    <p class="empty-state">Nenhuma edição encontrada.</p>
    {% endfor %}
</div>

<script>
    function switchCover(event, issueId, index) {
        event.preventDefault();
        event.stopPropagation();

        const card = event.target.closest('.card');

        // Hide all active images
        const images = card.querySelectorAll('.cover-image');
        images.forEach(img => img.classList.remove('active'));

        // Show target image
        const targetImg = card.querySelector(`#cover-${issueId}-${index}`);
        if (targetImg) targetImg.classList.add('active');

        // Update dots
        const dots = card.querySelectorAll('.nav-dot');
        dots.forEach(dot => dot.classList.remove('active'));

        // Activate target dot
        const targetDot = card.querySelector(`.nav-dot[data-index="${index}"]`);
        if (targetDot) targetDot.classList.add('active');
    }
</script>

{% if years %}
<div class="pagination-container"
    style="display: flex; flex-direction: column; align-items: center; gap: 1rem; margin-top: 2rem;">

    <div class="pagination-controls" style="display: flex; align-items: center; gap: 0.5rem;">
        <!-- First Year -->
        {% if current_year != first_year %}
        <a href="?year={{ first_year }}" class="btn" title="First Year ({{ first_year }})">&laquo; First</a>
        {% else %}
        <span class="btn disabled">&laquo; First</span>
        {% endif %}

        <!-- Previous Year -->
        {% if previous_year %}
        <a href="?year={{ previous_year }}" class="btn" title="Previous Year ({{ previous_year }})">&lsaquo; Prev</a>
        {% else %}
        <span class="btn disabled">&lsaquo; Prev</span>
        {% endif %}

        <!-- Current Year Display -->
        <span class="current-year" style="font-weight: bold; font-size: 1.2rem; padding: 0 1rem;">
            {{ current_year }}
        </span>

        <!-- Next Year -->
        {% if next_year %}
        <a href="?year={{ next_year }}" class="btn" title="Next Year ({{ next_year }})">Next &rsaquo;</a>
        {% else %}
        <span class="btn disabled">Next &rsaquo;</span>
        {% endif %}

        <!-- Last Year -->
        {% if current_year != last_year %}
        <a href="?year={{ last_year }}" class="btn" title="Last Year ({{ last_year }})">Last &raquo;</a>
        {% else %}
        <span class="btn disabled">Last &raquo;</span>
        {% endif %}
    </div>

    <!-- Go to specific year form -->
    <form action="" method="get" class="goto-year-form" style="display: flex; align-items: center; gap: 0.5rem;">
        <label for="year-input">Go to year:</label>
        <input type="number" id="year-input" name="year" min="{{ first_year }}" max="{{ last_year }}"
            value="{{ current_year }}" class="form-control" style="width: 80px; text-align: center;">
        <button type="submit" class="btn btn-sm">Go</button>
    </form>

</div>
{% endif %}
{% endblock %}