{% extends 'core/base.html' %}

{% block content %}
<div class="breadcrumb">
    <a href="{% url 'home' %}">Home</a> /
    <a href="{% url 'issue_list' %}">Edições</a> /
    {{ issue }}
</div>

<div class="header-actions">
    <h1>{{ issue }}</h1>
    <a href="{% url 'issue_delete' issue.pk %}" class="btn-trash open-modal" title="Delete Issue">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="3 6 5 6 21 6"></polyline>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
        </svg>
    </a>
</div>

<div class="card detail-section">
    <div class="header-actions" style="margin-bottom: 1rem;">
        <h2 class="detail-header" style="margin-bottom: 0;">Garotas nesta edição</h2>
        <a href="{% url 'issue_appearance_create' issue.pk %}" class="btn-circle-add open-modal"
            style="width: 32px; height: 32px; font-size: 20px;">+</a>
    </div>

    {% if sections_data %}
    <table>
        <thead>
            <tr>
                <th style="width: 20%;">Seção</th>
                <th style="width: 60%;">Mulheres</th>
                <th style="width: 20%;">Ações</th>
            </tr>
        </thead>
        <tbody>
            {% for group in sections_data %}
            <tr>
                <!-- Seção Column -->
                <td>
                    <span class="section-badge">
                        {{ group.section.name }}
                    </span>
                </td>

                <!-- Mulheres Column -->
                <td>
                    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; align-items: center;">
                        {% for appearance in group.appearances %}
                        <div class="woman-pill" style="display: inline-flex; align-items: center; background-color: #f3f4f6; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.875rem;">
                            <a href="{% url 'woman_detail' appearance.woman.pk %}" style="color: #374151; text-decoration: none; margin-right: 0.5rem;">
                                {{ appearance.woman.name }}
                            </a>
                            <a href="{% url 'appearance_delete' appearance.pk %}?next={% url 'issue_detail' issue.pk %}" 
                               class="open-modal"
                               style="color: #ef4444; cursor: pointer; display: flex; align-items: center;"
                               title="Remove {{ appearance.woman.name }} from this section">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <line x1="18" y1="6" x2="6" y2="18"></line>
                                    <line x1="6" y1="6" x2="18" y2="18"></line>
                                </svg>
                            </a>
                        </div>
                        {% endfor %}
                        
                        <!-- Add Woman to Section Button -->
                        <a href="{% url 'issue_appearance_create' issue.pk %}?section_id={{ group.section.pk }}" 
                           class="btn-circle-add-small open-modal"
                           style="width: 24px; height: 24px; font-size: 16px; background-color: #e5e7eb; color: #4b5563; display: flex; align-items: center; justify-content: center; border-radius: 50%; text-decoration: none;"
                           title="Add Woman to {{ group.section.name }}">
                            +
                        </a>
                    </div>
                </td>

                <!-- Ações Column -->
                <td>
                    <div style="display: flex; gap: 0.5rem;">
                        <a href="{% url 'issue_section_update' issue.pk group.section.pk %}" class="btn-icon-edit open-modal" title="Edit Section Group">
                            {% include 'core/includes/icon_edit.html' %}
                        </a>
                        <a href="{% url 'issue_section_delete' issue.pk group.section.pk %}" class="btn-icon-delete open-modal" title="Delete Section Group">
                            {% include 'core/includes/icon_trash.html' %}
                        </a>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p class="empty-state">Nenhuma garota encontrada nesta edição.</p>
    {% endif %}
</div>
{% endblock %}